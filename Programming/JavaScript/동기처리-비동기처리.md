# 동기 처리와 비동기 처리

자바스크립트는 함수를 호출하면 코드가 평가된 후, 함수 실행 컨텍스트가 생성된다. 이 함수 실행 컨텍스트가 콜스택에 푸쉬되고 이를 처리하는 것이다. 순서는 다음과 같다.

1. 코드가 실행되면 실행 컨텍스트(콜 스택)에 전역 실행 컨텍스트가 push 된다.
2. 함수 호출이 발생하면 함수 실행 컨텍스트를 콜 스택에 push 한다.
3. 함수가 완료되면 콜 스택에서 pop하고, 다음 함수를 push한다.
4. 호출할 함수가 있다면 2, 3 작업을 반복한다.
5. 코드 실행이 끝나면 전역 실행 컨텍스트까지 pop하고 종료된다.



## 동기 처리

자바스크립는 단 하나의 실행 컨텍스트만 가질 수 있고, 한 실행 컨텍스트 내에서는 하나의 작업만 수행할 수 있다. 따라서, 자바스크립트 엔진은 싱글 스레 방식으로 동작한다. 이로 인해, 어떤 함수가 실행되면, 그 작업이 완료될 때까지 다음 함수가 실행되지 못하는 **블로킹(작업중단)**이 발생한다. 이러한 과정이 **동기 처리** 방식이다.



## 비동기 처리

브라우저를 이용하다 보면 여러 작업이 동시에 수행되는 것을 느낄 수 있다. 자바스크립트 엔진은 싱글 스레드 방식인데 어떻게 동시에 작업이 가능한 것일까? 그 이유는 브라우저와 Node.js 가 **이벤트 루프(event loop)**와 **태스크 큐(Task Queue)**를 제공하기 때문이다. 

#### 용어

- 태스크 큐(Task Queue)

  작업이 완료된 비동기 함수를 순차적으로 저장하는 `대기 공간`이다. 이곳에 대기하고 있는 작업은 콜스택이 비면 먼저 대기하고 있던 함수부터 콜스택에 push되어 순차적으로 처리된다.

- 이벤트 루프(event loop)

  `콜 스택`과 `태스크 큐`를 <u>주기적으로 감시</u>한다. 콜 스택이 비어 있으면 태스크 큐에 있는 콜백을 콜 스택으로 push하여 처리한다. 



#### 동작 과정

1. 비동기 함수가 실행되면 `콜 스택`에 push된다.`호출 스케줄링`(타이머, 비동기 요청)을 등록하고 곧바로 pop을 한다. 호출 스케줄링과 같은 작업은 `브라우저`나 `Node.js`가 수행한다.
2. 다음 작업을 `콜 스택`에 push하여 작업을 진행한다. 먼저 실행된 비동기 함수는 더 이상 자바스크립트 엔진이 관리하지 않고 `브라우저`와 `Node.js`에게 권한을 넘기는 것이다.
3. `브라우저`와 `Node.js`는 `호출 스케줄링`(타이머 만료, 비동기 작업 완료)이 끝나면 `태스크 큐`로 이동시킨다.
4. 이벤트 루프가 `콜 스택`이 비어 있는 것을 확인하면 곧바로 `태스크 큐`에 있는 작업을 `콜 스택`으로 옮긴다.

이러한 방식으로 동작하기 때문에 동시성이 가능한 것이다. 이러한 방식이 비동기 처리이다.**자바스크립트 엔진**은 <u>싱글 스레드</u>로 동작하고, **브라우저**와 **Node.js**는 <u>멀티 스레드</u>를 지원한다.